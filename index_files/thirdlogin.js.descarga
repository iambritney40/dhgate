/*!
 *
 * 	DHgate Login 
 * 
 */
;(function(k,g,b){var a={thirdUrl:"https://secure.dhgate.com/usr/thirdjoinfree.do?isblank=true",bindUrl:"https://secure.dhgate.com/usr/signinAndAdd.do?isblank=true",codeUrl:"https://secure.dhgate.com/usr/checkcode.do?isblank=true",onSuccess:function(){},onCancel:function(){},language:i("language")||"www"};function l(){}function i(p){var o="",o=p+"=";if(0<document.cookie.length){return p=document.cookie.indexOf(o),-1!=p?(p+=o.length,o=document.cookie.indexOf(";",p),-1==o&&(o=document.cookie.length),document.cookie.substring(p,o)):""}}function h(o){try{window.__loginRegisterManager&&window.__loginRegisterManager.triggerLoading(o)}catch(p){console.log(p)}}var n=function(){var o=["publish_stream","email"];var p=["publish_stream","email","publish_actions"];var q=function(r){if(window.fbInitialized){r.call()}else{window.setTimeout(function(){r(r)},50)}};return{permissions:function(){return o},connectPermissions:function(){return p},login:function(t){t=t||{};var s=t.permissions||o.join(",");var r=t.handleConnect||n.handleConnect;q(function(){FB.login(function(u){r(u,t)},{scope:s})})},checkUserLoggedIn:function(r,s){q(function(){FB.getLoginStatus(function(t){if(t.status=="connected"){r.call()}else{s.call()}})})},handleConnect:function(v,r){var u=r.onSuccess||l,t=r.onCancel||l;if(!v.authResponse||!v.authResponse.accessToken){t.call();return}var s={accesstoken:v.authResponse.accessToken,thirduid:v.authResponse.userID,platformtype:0,url:""};FB.api("/me?access_token="+v.authResponse.accessToken,function(w){if(v.status==="connected"){s.emailadd=w.email;s.nickname=w.name;s.code=m.cache.code;s.create=!1;m._insertData(s,u,true)}})},_init:(function(t){if(window._isCnIp){return}var r=t.body.appendChild(t.createElement("iframe"));try{t=r.contentWindow.document}catch(s){r.src="javascript:void((function(){document.open();document.domain='"+document.domain+"';document.close()})())";t=r.contentWindow.document}r.style.cssText="position:absolute;border:0px;width:0px;height:0px;top:-10000px;";t.open().write("<body onload=\"window.fbAsyncInit = function() {FB.init({appId: 619487934836296,status: true,cookie: true,xfbml: true,oauth: true,version: 2.1});window.parent.FB = FB;window.parent.fbInitialized = true;};var e = document.createElement('script');e.src = document.location.protocol + '//connect.facebook.net/en_US/all.js';e.async = true;document.getElementById('fb-root').appendChild(e);\"><div id=\"fb-root\"></div></body>");t.close()})(k)}}();var e=function(){var o=["https://www.googleapis.com/auth/plus.login","https://www.googleapis.com/auth/userinfo.email"];var p={callback:"googleLoginCallback",approvalprompt:"force",clientid:"908751507097-qr3gvtf8pdfq7643lvh74b4h5scgov4j.apps.googleusercontent.com",cookiepolicy:"single_host_origin",requestvisibleactions:"http://schema.org/AddAction",scope:"https://www.googleapis.com/auth/plus.login https://www.googleapis.com/auth/userinfo.email"};var q=l;window.googleLoginCallback=function(r){if(r){if(r.error==undefined){e.handleConnect(r,q)}}};return{permissions:function(){return o},login:function(r){q=r.onSuccess||l;gapi.auth.signIn(p)},handleConnect:function(r,s){r.__success=s;this.getProfile(r)},getProfile:function(r){var s={accesstoken:gapi.auth.getToken().access_token,thirduid:r.userID,platformtype:1,url:""};gapi.client.load("oauth2","v2",function(){var t=gapi.client.oauth2.userinfo.get();t.execute(function(u){s.email=u.email})});gapi.client.load("plus","v1",function(){var t=gapi.client.plus.people.get({userId:"me"});t.execute(function(u){s.nickname=u.displayName;s.thirduid=u.id;s.emailadd=u.emails[0]["value"];s.code=m.cache.code;s.create=!1;m._insertData(s,r.__success,true)})})},signout:function(){var r="https://accounts.google.com/o/oauth2/revoke?token="+gapi.auth.getToken().access_token;$.ajax({type:"GET",url:r,async:false,contentType:"application/json",dataType:"jsonp",success:function(s){document.location.relaod()},error:function(s){alert("取消关联失败！请到 https://plus.google.com/apps 手动解除！");window.open("https://plus.google.com/apps")}})},_init:function(){if(window._isCnIp){return}var r=document.createElement("script");r.type="text/javascript";r.async=true;r.src="https://apis.google.com/js/client:platform.js?onload=render";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(r,t)}()}}();var f=function(o){var p={zIndex:1000,opacity:0.5,isIE6:/msie\s*6.0/.test(navigator.userAgent.toLowerCase()),container:"ui-layer-box",content:"ui-layer-content",close:"ui-layer-close"};this.options=$.extend(p,o||{});$("body").append($("<div>").attr("id",this.options.container));this.init()};f.prototype={init:function(){var o=this;this.container=$("#"+this.options.container);this.elMask=$("<div></div>");this.container.delegate("."+this.options.close,"click",function(){o.hide()})},setContent:function(o){this.container.html(o)},show:function(){var p=this,o=this.container;this.mask();o.show().css({position:"absolute",zIndex:this.options.zIndex+1,visibility:"hidden"});this.setCss();this.setPosition()},mask:function(){var o;if(!this.initMask){this.initMask=!0;o=this.elMask;o.css({position:"fixed",width:"100%",height:"100%",left:0,top:0,backgroundColor:"#fff",opacity:this.options.opacity,zIndex:this.options.zIndex});if(!!this.isIE6){o.css({position:"absolute",width:$(window).width(),height:Math.max($(window).height(),$(document.body).height())});var p=$("<iframe>");p.css({position:"absolute",width:$(window).width(),height:Math.max($(window).height(),$(document.body).height()),left:0,top:0,opacity:0}).attr({src:"about:blank"});o.append(p)}this.container.after(o)}else{this.elMask.show()}},hide:function(){this.container.hide();this.elMask.hide()},distroy:function(){this.container.remove();this.elMask.hide();this.elMask.remove();this.elMask=null;this.container=null},setPosition:function(){if(this.container.is(":hidden")){return}var s=$(window),r=this.container.height(),p=this.container.width(),q=s.height()/2-r/2+s.scrollTop(),o=s.width()/2-p/2+s.scrollLeft();this.container.css({top:q<0?0:q,left:o<0?0:o});if(this.elMask){if(this.isIE6){this.elMask.css({width:s.width(),height:Math.max(s.height(),$(document.body).height())})}else{this.elMask.css({width:"100%",height:"100%"})}}},setCss:function(){var o=this.container.find("."+this.options.content);this.container.css({width:o.outerWidth(true),visibility:"visible"})}};var m={doSignup:function(){},domain:"//"+a.language+".dhgate.com",cache:{code:null,thirdData:null},paltformLogin:function(p,o){var o=$.extend(a,o);this.options=o;m.request({url:this.options.codeUrl,success:function(q){try{m.cache.code=q.statusInfo}catch(r){m.cache.code=null}}});switch(p){case"google+":e.login(o);break;case"facebook":n.login(o);break;default:break}},request:function(q){var t=q.success||l,r=q.error||l,o=q.url||"",s=q.data||{},p=q.dataType||"jsonp";$.ajax({url:o,data:s,cache:!1,dataType:p,type:"post",success:t,error:r})},_insertData:function(q,r,o){var p=this;if(!this.cache.code){setTimeout(function(){p._insertData(q,r,o)},100);return}if(this.requesting){return}var p=this;success=r||this.onSuccess||l;if(o){this.cache.thirdData=q}this.requesting=!0;h(true);this.request({url:this.options.thirdUrl,data:q,cache:!1,success:function(v){p.requesting=!1;h(false);if(v.status==1){success.call(g,v,q);p.layer.hide()}else{if(v.status==2){var u=q.emailadd?q.emailadd:"",t=q.emailadd?'readonly="true"':"",s=d.join("").replace(/\$\{emailadd\}/ig,u).replace(/\$\{readonly\}/ig,t);p.layer.setContent(s);p.layer.show()}else{if(v.status==3){p.layer.setContent(j.join("").replace(/\$\{(\w+)\}/ig,q.emailadd));p.layer.show()}else{if(v.status==0){p.layer.setContent(c.join(""));p.showMsg([v.statusInfo])}else{p.layer.setContent(c.join(""));p.showMsg([v.statusInfo])}}}}},error:function(){p.requesting=!1;h(false)}})},_bindData:function(p,q){if(this.requesting){return}var o=this;success=q||this.onSuccess||l;this.requesting=!0;this.request({url:this.options.bindUrl,data:p,cache:!1,success:function(r){o.requesting=!1;if(r.status==1){success.call(g,r,p);o.layer.hide()}else{if(r.status==0){o.showMsg([r.statusInfo])}}},error:function(){o.requesting=!1}})},showMsg:function(o){if(o){o=typeof o=="string"?o:o.join(o.length>1?"<br />":"");this.layer.container.find(".-j-third-notice").html(o).show();this.layer.show()}},perfect:function(){},loadCSS:function(){$("head").append('<link rel="stylesheet" type="text/css" href="//css.dhresource.com/buyer/registerandsignin/thirdlogin.css" />')},init:function(){var p=this,o=/^([\w-.]+)@(([[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.)|(([\w-]+.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(]?)$/;this.layer=new f();this.loadCSS();this.layer.container.delegate(".-j-third-submit","click",function(){var s=p.cache.thirdData,r=p.layer.container.find("input[name=chooseaccount]:checked").attr("data-for"),t={thirduid:s.thirduid,accesstoken:s.accesstoken,emailadd:s.emailadd,platformtype:s.platformtype,nickname:s.nickname,create:s.create,password:s.url,url:s.url,code:p.cache.code},q;if(!!r&&r=="pwd"){t.password=$(".-j-third-pwd").val();t.checkcode=$(".-j-third-vcode").val();t.create=!1;q=[];if(t.password.length<1){q.push("Please enter your password.")}if(!t.checkcode||t.checkcode.length!=4){q.push("Please enter the security code above as it is.")}if(q.length>0){p.showMsg(q)}else{m._bindData(t,success)}}else{t.emailadd=$(".-j-third-email").val()||"";t.usertypebase=p.layer.container.find("input[name=usertypebase]:checked").val();t.password=null;t.create=!0;q=[];t.emailadd=t.emailadd.replace(/^\s+|\s+$/g,"");if(t.emailadd.length==0){q.push("Email address is required. Please try again.")}else{if(!o.test(t.emailadd)){q.push("The email address you entered is incorrect.")}}if(!t.usertypebase){q.push("Please choose at least one option.")}if(q.length>0){p.showMsg(q)}else{m._insertData(t,success)}}return});this.layer.container.delegate("input[name=chooseaccount]","change",function(){var s=$(this),r=$(".-j-check-signin"),q=s.attr("data-i");$(".-j-third-submit").val(q==0?"Connect":"Create and Connect");if(s.is(":checked")){r.hide();r.eq(q).show()}else{r.hide()}});this.layer.container.delegate(".-j-third-codeImg","click",$.proxy(this.refreshCode,this));this.layer.container.delegate(".-j-askhelp","mouseenter",function(q){$(this).siblings(".-j-helpcon").show()});this.layer.container.delegate(".-j-askhelp","mouseleave",function(q){$(this).siblings(".-j-helpcon").hide()})},refreshCode:function(o){var p=new Date().getTime().toString(36);$(o.target).attr("src","https://secure.dhgate.com/verifycode.jsp?width=95&amp;height=32&amp;fontsize=28&amp;charlength=4&amp;temp="+p);return false}};m.init();this.signIn=m;var d=['<div class="ui-layer-content findaccount createcenter clearfix" style="display:block; top:30px;">','<div class="findaccount-bt">Create and connect a DHgate account</div>','<div class="findaccount-notice -j-third-notice" style="display:none"></div>','<dl class="chdl">',"<dt>Email Address</dt>",'<dd><input type="text" data-for="email" ${readonly} class="ipt -j-third-email" value="${emailadd}"></dd>',"</dl>",'<dl class="chdl utype">','<dt>Business Type<span class="askhelp -j-askhelp"></span><div class="helpcon -j-helpcon" style="display:none"><div class="common-pop">The business type you provided will be used by DHgate to offer product recommendations suited to your needs.</div><div class="arrow-bo"></div></div></dt>',"<dd>",'<ul class="clearfix">','<li class="rf"><label><input type="radio" value="Reseller" name="usertypebase" />Reseller</label></li>','<li class="rf"><label><input type="radio" value="Purchase for compan" name="usertypebase" />Company Purchaser</label></li>','<li class="rf"><label><input type="radio" value="End Consumer" name="usertypebase" />Consumer</label></li>',"</ul>","</dd>","</dl>",'<dl class="findaccount-btn">','<dd><input type="button" value="Create and Connect" class="n-yellow-button -j-third-submit"></dd>',"</dl>",'<span class="icon-bclose ui-layer-close"></span>',"</div>"],j=['<div class="ui-layer-content findaccount clearfix" >','<div class="findaccount-bt">We find you might have a DHgate account</div>','<div class="findaccount-notice -j-third-notice" style="display:none"></div>','<div class="findaccount-ch">','<label><input type="radio" data-i="0" data-for="pwd" value="" checked name="chooseaccount">Connect DHgate account by <b class="-j-thirdemail">${emailadd}</b></label>','<div class="-j-check-signin">','<dl class="chdl">','<dt>DHgate Password<a class="fabsoright" target="_blank" href="//www.dhgate.com/usr/forgotpwd.do">Forgot password?</a></dt>','<dd><input type="password" name="" class="ipt -j-third-pwd"></dd>',"</dl>",'<dl class="chdl">','<dd class="verifycode">','<input type="text" class="ipt -j-third-vcode" maxlength="4" name="" />','<img class="-j-third-codeImg" width="95" height="32" src="https://secure.dhgate.com/verifycode.jsp?width=95&amp;height=32&amp;fontsize=28&amp;charlength=4&amp;temp=ixir4vy9" onclick="return false;this.src=\'https://secure.dhgate.com/verifycode.jsp?width=95&amp;height=32&amp;fontsize=28&amp;charlength=4&amp;temp=\'+ (new Date().getTime().toString(36)); return false;"></dd>',"</dl>","</div>","</div>",'<div class="findaccount-ch">','<label><input type="radio" data-i="1" data-for="email" value="" name="chooseaccount">Create and connect a new account</label>','<div class="-j-check-signin"  style="display:none;">','<dl class="chdl">',"<dt>Email Address</dt>",'<dd><input type="text" value="" class="ipt -j-third-email"></dd>',"</dl>",'<dl class="chdl utype">','<dt>Business Type<span class="askhelp -j-askhelp"></span><div class="helpcon -j-helpcon" style="display:none"><div class="common-pop">The business type you provided will be used by DHgate to offer product recommendations suited to your needs.</div><div class="arrow-bo"></div></div></dt>',"<dd>",'<ul class="clearfix">','<li class="rf"><label><input type="radio" value="Reseller" name="usertypebase" />Reseller</label></li>','<li class="rf"><label><input type="radio" value="Purchase for compan" name="usertypebase" />Company Purchaser</label></li>','<li class="rf"><label><input type="radio" value="End Consumer" name="usertypebase" />Consumer</label></li>',"</ul>","</dd>","</dl>","</div>","</div>",'<dl class="findaccount-btn">','<dd><input type="button" value="Connect" class="n-yellow-button -j-third-submit"></dd>',"</dl>",'<span class="icon-bclose ui-layer-close"></span>',"</div>"],c=['<div class="ui-layer-content findaccount clearfix" >','<div class="findaccount-notice -j-third-notice" style="display:none"></div>','<span class="icon-bclose ui-layer-close"></span>',"</div>"]})(document,window,undefined);function fbLogin(){window.FB&&signIn.paltformLogin("facebook",{onSuccess:function(e,d,f){if(window.top!=window.self){window.__iframeLayerLogin&&window.__iframeLayerLogin.triggerSendMessage()}else{location.href=signIn.domain}}})}function gLogin(){window.FB&&signIn.paltformLogin("google+",{onSuccess:function(e,d,f){if(window.top!=window.self){window.__iframeLayerLogin&&window.__iframeLayerLogin.triggerSendMessage()}else{location.href=signIn.domain}}})};